---
- name: Create Bastion
  hosts: localhost
  environment:
    OS_CLOUD: "{{ cloud_name }}"
  tasks:
    - include_role:
        name: bastion

    - include_tasks: ../common/cache_required_hostvars.yaml
      vars:
        group_name: "bastions"
        cache_file: "{{ bastions_group_cache_file | default('/tmp/ansible_group_bastions_cache.yaml') }}"


# - name: Provision Bastion
#   hosts: bastions
#   become: true
#   tasks:
#     - include_role:
#         name: bastion
#         tasks_from: install.yaml

# - name: Deploy OpenStack client configuration
#   hosts: localhost
#   environment:
#     OS_CLOUD: "{{ cloud_name }}"
#   tasks:
#     - include_role:
#         name: bastion
#         tasks_from: os_client_config.yaml

- name: message
  hosts: localhost
  tasks:
    - name: print notice
      debug:
        msg: "Configure your SSH to have bastion {{ groups.bastions[0] }} be used as a proxy to other subnets"
